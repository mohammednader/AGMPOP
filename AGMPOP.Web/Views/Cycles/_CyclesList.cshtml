@model List<AGMPOP.BL.Models.ViewModels.CycleVM>
@using AGMPOP.BL.Models.ViewModels
@{var CurrentDate = DateTime.Today;}
<div class="row">
    <div class="col-md-12">
        <div class="card card-body">

            <table id="cycles-table" class="table table-bordered table-striped table-responsive-sm table-responsive-md table-responsive-lg">
                <thead>
                    <tr>
                        <th data-field="id" class="text-center">ID</th>
                        <th data-field="name" class="text-center">Name</th>
                        <th data-field="type" class="text-center">Type</th>
                        <th data-field="department" class="text-center">Department</th>
                        <th data-field="from" class="text-center">From</th>
                        <th data-field="to" class="text-center">To</th>
                        <th data-field="reconciliationdate" class="text-center">Reconciliation Date</th>
                        <th class="text-center">Status</th>
                        <th class="text-center">Active/Inactive</th>
                        <th class=" text-right">Actions</th>
                    </tr>
                </thead>
                <tbody>

                    @{

                        if (Model.Count != 0)
                        {



                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td class="text-center">
                                        @item.CycleId
                                    </td>
                                    <td class="text-center">
                                        <a href="CycleDetails/@item.CycleId" class="btn-link">@item.Name</a>
                                    </td>
                                    <td class="text-center">
                                        @if (item.CycleType == 1)
                                        {
                                            @(((POPEnums.CycleType.NationWide)).ToString())

                                        }
                                        else
                                        {
                                            @(((POPEnums.CycleType.Event)).ToString())
                                        }
                                    </td>
                                    <td>
                                        @item.DepartmentName
                                    </td>
                                    <td class="text-center">
                                        @Html.DisplayFor(modelItem => item.StartDate)
                                    </td>
                                    <td class="text-center">
                                        @Html.DisplayFor(modelItem => item.EndDate)
                                    </td>
                                    <td class="text-center">
                                        @Html.DisplayFor(modelItem => item.ReconciliationDate)
                                    </td>
                                    <td class="text-center">
                                        @if (item.StartDate > CurrentDate)
                                        {
                                            @(((POPEnums.CycleStatus.New)).ToString())
                                        }
                                        else if (item.StartDate <= CurrentDate && item.EndDate >= CurrentDate)
                                        {
                                            @(((POPEnums.CycleStatus.Running)).ToString())
                                        }
                                        else if (item.EndDate < CurrentDate)
                                        {
                                            @(((POPEnums.CycleStatus.Ended)).ToString())
                                        }
                                    </td>

                                    <td class=" text-center">
                                        @if (item.CycleIsActive == true)
                                        {
                                            <text>Active</text>
                                        }
                                        else
                                        {
                                            <text>Inactive</text>
                                        }
                                    </td>
                                    <td class="text-center">
                                        <a class="material-tooltip-main btn-primary  btn btn-floating my-0 p-0" data-toggle="tooltip" title="Edit" href='@Url.Action("UpdateCycle", "Cycles", new { Id = item.CycleId })'>
                                            <i class="fas fa-edit " style="font-size:15px; margin-top:-5px;"></i>
                                        </a>

                                        @if (item.CycleIsActive == false)
                                        {
                                            <button class="material-tooltip-main btn btn-success btn-floating my-0 p-0 btnActivation" data-toggle="tooltip" title="active" value="@item.CycleId">
                                                <i class="fad fa-user-check" style="font-size:15px; margin-top:-5px;"></i>
                                            </button>


                                        }
                                        else
                                        {
                                            <button class="material-tooltip-main btn btn-danger btn-floating my-0 p-0 btnDectivation " data-toggle="tooltip" title="Deactivate" value="@item.CycleId">
                                                <i class="fad fa-user-times " style="font-size:15px; margin-top:-5px;"></i>
                                            </button>

                                        }

                                    </td>

                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="10"> There is no data to view</td>
                            </tr>

                        }
                    }

                </tbody>
            </table>
        </div><!--  end card  -->
    </div> <!-- end col-md-12 -->
</div> <!-- end row -->
@if (Model.Count > 0)
{
    <script>
        $(document).ready(function () {

            $('#cycles-table').DataTable({
                "ordering": false,
                // "order": [[3, "desc"]]
            });


        });
    </script>
}




<script type="text/javascript">
        $(function () {
            $(".btnActivation").click(function (e) {
                var CycletId = $(this).val();

                Swal.fire({
                     text: "Active Cycle!",
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#888',
                    confirmButtonText: 'Yes, Activate it!'
                }).then((result) => {
                    if (result.value) {
                        $.ajax({
                            url: '@Url.Action("Activate", "Cycles")',
                            data: { CycletId },
                            type: "Post",
                            success: function (data) {

                                if (data.success == true) {
                                    Swal.fire({
                                        text: data.message,
                                        icon: 'success'
                                    }).then(
                                        function () {
                                            loadCycleData();

                                        }
                                    );
                                }

                                else {
                                    Swal.fire({
                                        text: data.message,
                                        icon: 'error'
                                    })
                                }

                            },

                        });
                    }
                })

            })
        })

        $(function () {
            $(".btnDectivation").click(function (e) {
                var CycletId = $(this).val();
                Swal.fire({
                    text: "Deactivate Cycle!",
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, Deactivate it!'
                }).then((result) => {
                    if (result.value) {
                        $.ajax({
                            url: '@Url.Action("Deactivate", "Cycles")',
                            data: { CycletId },
                            type: "Post",
                            success: function (data) {

                                if (data.success == true) {
                                    Swal.fire({
                                        text: data.message,
                                        icon: 'success'
                                    }).then(
                                        function () {
                                            loadCycleData();

                                        }
                                    );
                                }

                                else {
                                    Swal.fire({
                                        text: data.message,
                                        icon: 'error'
                                    })
                                }
                            },
                        });


                    }

                })

            })
        })

</script>
